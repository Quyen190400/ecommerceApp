<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beui | Trang chủ</title>
    <link rel="stylesheet" th:href="@{/css/tea-home.css}">
    <link rel="stylesheet" th:href="@{/css/auth-forms.css}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/png" href="/images/logo.png">
    <style>
        html, body { scroll-behavior: smooth; }
        :root {
            --main-bg: #E6F2E6;
            --header-green: #2C6E49;
            --main-green: #40916C;
            --sub-green: #A3B18A;
            --card-border: #A3B18A;
            --btn-outline: #95D5B2;
            --btn-light-bg: #EDF6F9;
            --btn-light-text: #1B4332;
            --highlight: #1B9C85;
            --highlight2: #43AA8B;
            --main-text: #1E1E1E;
            --white: #FFFFFF;
        }
        body {
            background: var(--main-bg);
            color: var(--main-text);
        }
        .product-card, .card {
            background: var(--white);
            border: 1.5px solid var(--card-border);
            border-radius: 12px;
            box-shadow: none;
        }
        .product-title, .card-title {
            color: var(--main-text);
            font-weight: 700;
        }
        .product-price, .highlight, .price {
            color: var(--highlight);
            font-weight: 700;
        }
        /* Responsive giữ nguyên layout, chỉ đổi màu */
        
        /* Message Styles */
        .message-container {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
        }
        
        .success-message, .error-message {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .success-message i {
            color: #28a745;
        }
        
        .error-message i {
            color: #dc3545;
        }
        body.dark-theme, .dark-mode, body.dark-mode {
            background: #1a1a1a !important
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* Auto hide messages after 5 seconds */
        .message-container {
            animation: slideDown 0.3s ease, fadeOut 0.3s ease 4.7s forwards;
        }
        
        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
        }
    </style>
    <script th:inline="javascript">
        /*<![CDATA[*/
        if (localStorage.getItem('theme') === 'dark') {
          document.documentElement.classList.add('dark');
        }
        /*]]>*/
    </script>
</head>
<body class="light-theme" >
<script>
    (function() {
      try {
        var theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          document.documentElement.classList.add('dark-theme');
          document.body && document.body.classList.add('dark-theme');
        }
      } catch(e){}
    })();
</script>
<!-- Include Header Fragment -->
<div th:replace="~{fragments/header :: header}"></div>
<div class="main-content">
<!-- Success/Error Messages -->
<div class="message-container" th:if="${success}">
    <div class="success-message">
        <i class="fas fa-check-circle"></i>
        <span th:text="${success}">Đăng ký thành công!</span>
    </div>
</div>

<div class="message-container" th:if="${error}">
    <div class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${error}">Có lỗi xảy ra</span>
    </div>
</div>

<!-- Hero Section -->
<section id="home" class="hero">
    <div class="hero-overlay">
        <div class="hero-content">
            <h1 class="calligraphy">Trà Đạo - Hương Vị Ngàn Năm</h1>
            <p class="hero-slogan">Thưởng thức tinh hoa trà Việt giữa thiên nhiên xanh mát</p>
            <a href="#art" class="cta-btn">Khám phá trà xanh</a>
        </div>
    </div>
</section>

<!-- Giới thiệu -->
<section class="intro">
    <div class="intro-img">
        <img th:src="@{/images/banner3.jpg}" alt="Người hái chè">
    </div>
    <div class="intro-text">
        <h2>Văn hóa Trà Xanh</h2>
        <p>
            Từ ngàn xưa, trà xanh đã trở thành biểu tượng của sự thanh khiết, tĩnh lặng và tinh tế trong đời sống người Á Đông.
            Mỗi tách trà là một hành trình cảm nhận, nơi tâm hồn hòa quyện cùng thiên nhiên, gác lại bộn bề để tìm về sự an yên.
        </p>
    </div>
</section>
</section>

<!-- Chủ đề trà -->
<section id="art" class="topics">
    <h2>Nghệ Thuật Trà</h2>
    <div class="topic-grid">
        <div class="topic-card">
            <img src="/images/tra-dao.png" alt="Trà Đạo">
            <h3>Trà Đạo</h3>
            <p>Nghệ thuật thưởng trà, hòa mình vào thiên nhiên.</p>
        </div>
        <div class="topic-card">
            <img src="/images/tra-nghe.png" alt="Trà Nghệ">
            <h3>Trà Nghệ</h3>
            <p>Tinh hoa chế biến và pha trà truyền thống.</p>
        </div>
        <div class="topic-card">
            <img src="/images/tra-vi.png" alt="Trà Vị">
            <h3>Trà Vị</h3>
            <p>Khám phá hương vị trà xanh thuần khiết.</p>
        </div>
        <div class="topic-card">
            <img src="/images/tra-cu.png" alt="Trà Cụ">
            <h3>Trà Cụ</h3>
            <p>Bộ ấm chén, phụ kiện trà đạo tinh xảo.</p>
        </div>
    </div>
</section>

<!-- Sản phẩm nổi bật -->
<section class="featured-products">
    <h2>Sản phẩm bán chạy</h2>
    <div class="products-grid">
        <div class="product-card" th:each="product : ${featuredProducts}">
            <div class="product-image">
                <img th:src="${product.imageUrl}" th:alt="${product.name}">
            </div>
            <div class="product-info">
                <h4 class="product-title-multiline" th:text="${product.name}">Tên sản phẩm</h4>
                <p class="sold-count" th:text="'Đã bán: ' + ${product.soldCount} + ' sản phẩm'"></p>
                <p class="price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + 'đ'}">0đ</p>
                <div class="product-actions">
                    <a th:href="@{'/product/' + ${product.id}}" class="view-btn">Xem chi tiết</a>
                    <button type="button" class="add-cart-btn" th:attr="data-product-id=${product.id}" title="Thêm vào giỏ hàng">
                        <i class="fas fa-cart-plus"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Tất cả sản phẩm -->
<section id="products" class="all-products">
    <h2>Tất cả sản phẩm</h2>
    <div class="products-grid" id="productsGrid">
        <div class="product-card" th:each="product,iterStat : ${allProducts}" th:classappend="${iterStat.index} >= 8 ? 'hidden-product' : ''">
            <div class="product-image">
                <img th:src="${product.imageUrl}" th:alt="${product.name}">
            </div>
            <div class="product-info">
                <h4 th:text="${product.name}">Tên sản phẩm</h4>
                <p class="price" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + 'đ'}">0đ</p>
                <p class="description" th:text="${#strings.abbreviate(product.description, 100)}">Mô tả sản phẩm...</p>
                <div class="product-actions">
                    <a th:href="@{'/product/' + ${product.id}}" class="view-btn">Xem chi tiết</a>
                    <button type="button" class="add-cart-btn" th:attr="data-product-id=${product.id}" title="Thêm vào giỏ hàng">
                        <i class="fas fa-cart-plus"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="load-more">
        <button class="load-more-btn" id="loadMoreBtn" data-expanded="false" onclick="toggleProducts()">Xem thêm</button>
    </div>
</section>
<style>
    .hidden-product { display: none !important; }
</style>
<script>
    function toggleProducts() {
        const cards = document.querySelectorAll('.products-grid .product-card');
        const btn = document.getElementById('loadMoreBtn');
        // Hiện tất cả sản phẩm
        cards.forEach(e => e.classList.remove('hidden-product'));
        // Ẩn nút nếu không còn sản phẩm nào cần hiển thị
        btn.style.display = 'none';
    }
    // Ẩn nút nếu tổng số sản phẩm <= 8
    window.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.products-grid .product-card');
        const btn = document.getElementById('loadMoreBtn');
        if (cards.length <= 8 && btn) {
            btn.style.display = 'none';
        }
    });
</script>

<!-- Hướng dẫn chọn trà -->
<section class="tea-guides">
    <h2>Hướng dẫn chọn trà phù hợp</h2>
    <div class="guides-carousel-custom">
        <button class="carousel-prev">&lt;</button>
        <div class="carousel-track"></div>
        <button class="carousel-next">&gt;</button>
    </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Lấy HTML của từng cart từ Swiper cũ (nếu còn)
      const oldSlides = document.querySelectorAll('.guides-carousel .swiper-slide');
      let carts = [];
      if (oldSlides.length) {
        carts = Array.from(oldSlides).map(el => el.outerHTML);
      } else {
        // Nếu không còn Swiper, lấy từ HTML tĩnh (nếu có)
        carts = [
          `<div class="guide-card"><div class="guide-image"><img src="/images/tra-an-than.jpg" alt="Trà An Thần"></div><div class="guide-content"><h3>Trà An Thần</h3><p>Giúp thư giãn, ngủ ngon, giảm stress và lo âu.</p><p class="suggested-product">Gợi ý: <span>Trà hoa cúc an thần</span></p><button class="guide-btn" data-benefit="an-than"><i class="fas fa-eye" style="margin: 0 8px;"></i> Xem sản phẩm</button></div></div>`,
          `<div class="guide-card"><div class="guide-image"><img src="/images/tra-giam-can.jpg" alt="Trà Giảm Cân"></div><div class="guide-content"><h3>Trà Giảm Cân</h3><p>Hỗ trợ giảm cân, thanh lọc cơ thể, tốt cho sức khỏe.</p><p class="suggested-product">Gợi ý: <span>Trà xanh giảm cân</span></p><button class="guide-btn" data-benefit="giam-can"><i class="fas fa-eye"  style="margin: 0 8px;"></i> Xem sản phẩm</button></div></div>`,
          `<div class="guide-card"><div class="guide-image"><img src="/images/tra-thu-gian.jpg" alt="Trà Thảo mộc"></div><div class="guide-content"><h3>Trà Thảo mộc</h3><p>Giúp làm dịu thần kinh, hỗ trợ tiêu hóa, tăng cường sức khỏe.</p><p class="suggested-product">Gợi ý: <span>Trà hoa cúc nguyên bông</span></p><button class="guide-btn" data-benefit="thao-moc"><i class="fas fa-eye"  style="margin: 0 8px;"></i> Xem sản phẩm</button></div></div>`,
          `<div class="guide-card"><div class="guide-image"><img src="/images/bo-am-tra.jpg" alt="Dụng cụ trà"></div><div class="guide-content"><h3>Dụng cụ trà</h3><p>Bộ ấm chén, phụ kiện trà đạo tinh xảo, nâng tầm trải nghiệm thưởng trà.</p><p class="suggested-product">Gợi ý: <span>Bộ ấm chén Bát Tràng</span></p><button class="guide-btn" data-benefit="dung-cu"><i class="fas fa-eye"  style="margin: 0 8px;"></i> Xem sản phẩm</button></div></div>`
        ];
      }
      let currentIndex = 0;
      const track = document.querySelector('.carousel-track');
      function getVisibleCount() {
        if (window.innerWidth < 700) return 1;
        if (window.innerWidth < 1000) return 2;
        return 3;
      }
      function updateDisplay() {
        track.innerHTML = '';
        const visibleCount = getVisibleCount();
        for (let i = 0; i < visibleCount; i++) {
          const idx = (currentIndex + i) % carts.length;
          track.innerHTML += carts[idx];
        }
        // Gán lại sự kiện click cho các nút .guide-btn
        track.querySelectorAll('.guide-btn').forEach(btn => {
          btn.onclick = function() {
            const benefit = btn.getAttribute('data-benefit');
            if (benefit) {
              window.location.href = `/tea-guide/${benefit}`;
            }
          };
        });
      }
      // Tắt auto chuyển tab
      function resetAutoplay() {
        clearInterval(window.carouselTimer);
        window.carouselTimer = setInterval(() => {
          currentIndex = (currentIndex + 1) % carts.length;
          updateDisplay();
        }, 5000);
      }
      document.querySelector('.carousel-prev').onclick = function() {
        const visibleCount = getVisibleCount();
        currentIndex = (currentIndex - visibleCount + carts.length) % carts.length;
        updateDisplay();
        resetAutoplay();
      };
      document.querySelector('.carousel-next').onclick = function() {
        const visibleCount = getVisibleCount();
        currentIndex = (currentIndex + visibleCount) % carts.length;
        updateDisplay();
        resetAutoplay();
      };
      window.addEventListener('resize', updateDisplay);
      updateDisplay();
      resetAutoplay();
    });
</script>

<!-- Thông tin liên hệ & bản đồ -->
<section id="contact" class="contact-info">
    <h2>Thông tin liên hệ</h2>
    <div class="contact-container">
        <div class="contact-details">
            <div class="contact-item">
                <i class="fas fa-map-marker-alt"></i>
                <div>
                    <h4>Địa chỉ</h4>
                    <p>123 Đường Trà Xanh, Quận 12, TP.HCM</p>
                </div>
            </div>
            <div class="contact-item">
                <i class="fas fa-phone"></i>
                <div>
                    <h4>Hotline</h4>
                    <p>0909 123 456</p>
                </div>
            </div>
            <div class="contact-item">
                <i class="fas fa-envelope"></i>
                <div>
                    <h4>Email</h4>
                    <p>info@beui.com</p>
                </div>
            </div>
            <div class="contact-item">
                <i class="fas fa-clock"></i>
                <div>
                    <h4>Giờ hoạt động</h4>
                    <p>8:00 - 22:00 (Thứ 2 - Chủ nhật)</p>
                </div>
            </div>
            <div class="social-links">
                <a href="https://www.facebook.com" class="social-link" target="_blank" rel="noopener noreferrer"><i class="fab fa-facebook"></i></a>
                <a href="https://www.instagram.com/reel/C6lbf5rPk4U/?hl=am-et" class="social-link" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
                <a href="https://youtu.be/15b0Ox8Qwe4" class="social-link" target="_blank" rel="noopener noreferrer"><i class="fab fa-youtube"></i></a>
                <a href="https://www.tiktok.com" class="social-link" target="_blank" rel="noopener noreferrer"><i class="fab fa-tiktok"></i></a>
            </div>
        </div>
        <div class="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3919.424098982303!2d106.6983153!3d10.7769!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTDCsDQ2JzM2LjgiTiAxMDbCsDQxJzUzLjQiRQ!5e0!3m2!1svi!2s!4v1234567890"
                    width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </div>
</section>

<!-- Scroll to top button -->
<button class="scroll-to-top" id="scrollToTop">
    <i class="fas fa-chevron-up"></i>
</button>

</div>
<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    // Theme switching functionality
    document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        // Load saved theme from localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            body.className = 'dark-theme';
            if (themeToggle) themeToggle.checked = true;
        } else {
            body.className = 'light-theme';
        }

        // Theme toggle event
        if (themeToggle) {
            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    body.className = 'dark-theme';
                    localStorage.setItem('theme', 'dark');
                } else {
                    body.className = 'light-theme';
                    localStorage.setItem('theme', 'light');
                }
            });
        }

        // Smooth scrolling for navigation links
        const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href && href.startsWith('#')) {
                    e.preventDefault();
                    const targetId = href.substring(1);
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        const navbarHeight = document.querySelector('.navbar').offsetHeight;
                        const targetPosition = targetElement.offsetTop - navbarHeight;

                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });

        // Update active nav link based on scroll position
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');

            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                const sectionHeight = section.clientHeight;
                if (window.pageYOffset >= sectionTop && window.pageYOffset < sectionTop + sectionHeight) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });



        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');

        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                mobileMenuBtn.classList.toggle('active');
                mobileMenu.classList.toggle('show');
            });
        }

        // Cart functionality is now handled by handleCartClick in user-dropdown.js

        // Navbar scroll effect
        const navbar = document.querySelector('.navbar');
        if (navbar) {
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 100) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });
        }

        // Scroll to top functionality
        const scrollToTopBtn = document.getElementById('scrollToTop');

        if (scrollToTopBtn) {
            // Show/hide scroll to top button
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    scrollToTopBtn.classList.add('show');
                } else {
                    scrollToTopBtn.classList.remove('show');
                }
            });

            // Scroll to top when button is clicked
            scrollToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // Load more products functionality
        const loadMoreBtn = document.querySelector('.load-more-btn');
        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', function() {
                this.textContent = 'Đang tải...';
                this.disabled = true;

                setTimeout(() => {
                    this.textContent = 'Xem thêm';
                    this.disabled = false;
                }, 1000);
            });
        }

        // Product card hover effects
        const productCards = document.querySelectorAll('.product-card, .featured-card, .guide-card');
        productCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });

            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
    });
</script>

<!-- Auth Modal -->
<div th:replace="~{fragments/auth-modal :: authModal}"></div>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <div class="toast-content">
        <i class="toast-icon"></i>
        <span class="toast-message"></span>
    </div>
    <button class="toast-close">
        <i class="fas fa-times"></i>
    </button>
</div>

<script th:src="@{/js/cart.js}"></script>
<script th:src="@{/js/auth-forms.js}"></script>
<script th:src="@{/js/user-dropdown.js}"></script>
<script>
    function updateCartBadge() {
        fetch('/api/cart/count', {
            credentials: 'include'
        })
        .then(response => {
            if (response.status === 401 || response.status === 403) {
                const cartBadge = document.getElementById('cartBadge');
                if (cartBadge) {
                    cartBadge.textContent = '';
                    cartBadge.style.display = 'none';
                }
                return null;
            }
            return response.json();
        })
        .then(data => {
            if (!data) return;
            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                if (data.count && data.count > 0) {
                    cartBadge.textContent = data.count;
                    cartBadge.style.display = 'inline-block';
                } else {
                    cartBadge.textContent = '';
                    cartBadge.style.display = 'none';
                }
            }
        })
        .catch(error => {
            const cartBadge = document.getElementById('cartBadge');
            if (cartBadge) {
                cartBadge.textContent = '';
                cartBadge.style.display = 'none';
            }
            console.error('Error updating cart badge:', error);
        });
    }
    document.addEventListener('DOMContentLoaded', updateCartBadge);
</script>
<!-- Đảm bảo các link header -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
            if (link.getAttribute('href') === '#tea-art') link.setAttribute('href', '#art');
        });
    });
</script>
<script th:src="@{/js/theme-toggle.js}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Header desktop
        const headerLoginBtn = document.getElementById('headerLoginBtn');
        if (headerLoginBtn) {
            headerLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('login');
            });
        }
        const headerRegisterBtn = document.getElementById('headerRegisterBtn');
        if (headerRegisterBtn) {
            headerRegisterBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('register');
            });
        }
        // Mobile menu
        const mobileLoginBtn = document.getElementById('mobileLoginBtn');
        if (mobileLoginBtn) {
            mobileLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('login');
            });
        }
        const mobileRegisterBtn = document.getElementById('mobileRegisterBtn');
        if (mobileRegisterBtn) {
            mobileRegisterBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showAuthModal('register');
            });
        }
    });
</script>
<script>
    // Thêm sự kiện cho nút Xem sản phẩm trong tea-guide
    function setupGuideBtnNav() {
      document.querySelectorAll('.guide-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const benefit = btn.getAttribute('data-benefit');
          if (benefit) {
            window.location.href = `/tea-guide/${benefit}`;
          }
        });
      });
    }
    document.addEventListener('DOMContentLoaded', setupGuideBtnNav);
</script>
<script>
    // Đánh dấu trạng thái đăng nhập (giả sử backend truyền biến isLoggedIn)
    window.isLoggedIn = /*[[${#authentication.principal != null}]]*/ false;
    document.addEventListener('DOMContentLoaded', function() {
        // Tự động mở popup login nếu có expired=true và chưa đăng nhập
        const urlParams = new URLSearchParams(window.location.search);
        const isExpired = urlParams.get('expired') === 'true';
        if (isExpired && !window.isLoggedIn) {
            window.location.href = `/`;
            showAuthModal('login');
        }
    });
</script>
<script>
// Scroll spy: Gạch chân nav-link khi cuộn tới section tương ứng
window.addEventListener('DOMContentLoaded', function() {
    const sections = [
        {id: 'home', nav: ['/', '/#home']},
        {id: 'art', nav: ['/\#art']},
        {id: 'products', nav: ['/\#products']},
        {id: 'contact', nav: ['/\#contact']}
    ];
    const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
    function onScrollSpy() {
        let scrollPos = window.scrollY || document.documentElement.scrollTop;
        let found = false;
        for (let i = sections.length - 1; i >= 0; i--) {
            const sec = document.getElementById(sections[i].id);
            if (sec && scrollPos + 80 >= sec.offsetTop) {
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (sections[i].nav.some(href => link.getAttribute('href').endsWith(href))) {
                        link.classList.add('active');
                    }
                });
                found = true;
                break;
            }
        }
        // Nếu không section nào match, active Trang chủ
        if (!found) {
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '/' || link.getAttribute('href') === '/#home') {
                    link.classList.add('active');
                }
            });
        }
    }
    window.addEventListener('scroll', onScrollSpy);
    onScrollSpy();
});
</script>
<script>
let allProducts = [];
let suggestList = document.getElementById('searchSuggestList');
let searchInput = document.getElementById('productSearchInput');
let fetched = false;
let blurTimeout = null;

function renderSuggestList(keyword) {
    console.log('renderSuggestList called with:', keyword);
    if (!keyword || keyword.trim() === '') {
        suggestList.classList.remove('show');
        suggestList.style.display = 'none';
        suggestList.innerHTML = '';
        return;
    }
    const kw = keyword.trim().toLowerCase();
    const matches = allProducts.filter(p => p.name && p.name.toLowerCase().includes(kw));
    console.log('matches:', matches);
    if (matches.length === 0) {
        suggestList.innerHTML = `<div class="dropdown-item" style="cursor:default; padding:8px 16px; color:#888; background:#fff;">Không tìm thấy sản phẩm phù hợp</div>`;
        suggestList.classList.add('show');
        suggestList.style.display = 'block';
        suggestList.style.zIndex = '9999';
        return;
    }
    suggestList.innerHTML = matches.slice(0, 8).map(p =>
        `<div class="dropdown-item" style="cursor:pointer; padding:8px 16px; border-bottom:1px solid #f0f0f0; background: #fff; color: #222;" data-id="${p.id}">${p.name}</div>`
    ).join('');
    suggestList.classList.add('show');
    suggestList.style.display = 'block';
    suggestList.style.zIndex = '9999';
    // Gắn sự kiện click
    suggestList.querySelectorAll('.dropdown-item').forEach(item => {
        item.onclick = function() {
            window.location.href = '/product/' + item.getAttribute('data-id');
        };
    });
    console.log('Dropdown rendered, should be visible now.');
}

async function fetchProductsForSuggest() {
    try {
        let res = await fetch('/api/products');
        if (res.ok) {
            let data = await res.json();
            allProducts = data.filter(p => p.status === true || p.status === 1);
            fetched = true;
            console.log('Fetched products:', allProducts);
        }
    } catch (e) { allProducts = []; }
}

if (searchInput) {
    searchInput.addEventListener('focus', async function() {
        if (!fetched) {
            await fetchProductsForSuggest();
        }
        if (this.value) renderSuggestList(this.value);
    });
    searchInput.addEventListener('input', async function() {
        if (!fetched) {
            await fetchProductsForSuggest();
        }
        renderSuggestList(this.value);
    });
    // Sửa lại sự kiện blur: chỉ ẩn dropdown nếu không click vào dropdown
    searchInput.addEventListener('blur', function() {
        blurTimeout = setTimeout(() => {
            suggestList.classList.remove('show');
            suggestList.style.display = 'none';
        }, 180);
    });
    // Nếu click vào dropdown thì không ẩn
    suggestList.addEventListener('mousedown', function(e) {
        e.preventDefault();
        clearTimeout(blurTimeout);
    });
}
</script>
<style>
.contact-item {
    display: flex;
    align-items: flex-start;
    gap: 18px;
    margin-bottom: 24px;
}
.contact-item i {
    font-size: 2rem;
    color: #2E3D23;
    min-width: 36px;
    text-align: center;
    margin-top: 2px;
}
.contact-item h4 {
    margin: 0 0 4px 0;
    font-size: 1.15em;
    color: #2E3D23;
}
.contact-item p {
    margin: 0;
    color: #555;
    font-size: 1em;
}
</style>
</body>
</html> 